name: adams
registry: tjackadams

ingress:
  - name: ingress
    rules:
      - host: identity.itadams.co.uk
        service: identity-api
      - host: status.itadams.co.uk
        service: webstatus
      - host: app.itadams.co.uk
        service: webblazor

services:

- name: identity-api
  dockerFile: Services/Identity/Identity.Api/Dockerfile
  dockerFileContext: .
  env:
  - ASPNETCORE_ENVIRONMENT
  - ConnectionStrings__Identity
  - ConnectionStrings__Redis
  - Serilog__SeqServerUrl
  - OrchestratorType
  - IsClusterEnv
  - SendGrid__Key
  - AZURE_CLIENT_ID
  - AZURE_CLIENT_SECRET
  - AZURE_TENANT_ID
  - AzureKeyVault__VaultUri
  - AzureKeyVault__CertificateName
  - BlazorClient=https://app.itadams.co.uk
  - SmokingApiClient=http://smoking-api
  bindings:
  - name: http
    protocol: http

- name: smoking-api
  dockerFile: Services/Smoking/Smoking.Api/Dockerfile
  dockerFileContext: .
  env:
  - ASPNETCORE_ENVIRONMENT
  - ConnectionStrings__Smoking
  - Serilog__SeqServerUrl
  - OrchestratorType
  - IsClusterEnv
  bindings:
  - name: http
    protocol: http

- name: webstatus
  dockerFile: Web/WebStatus/Dockerfile
  dockerFileContext: .
  env:
  - ASPNETCORE_ENVIRONMENT
  - HealthChecksUI__HealthChecks__0__Name="WebBlazor HTTP Check""
  - HealthChecksUI__HealthChecks__0__Uri=http://webblazor/hc
  - HealthChecksUI__HealthChecks__1__Name="Identity HTTP Check"
  - HealthChecksUI__HealthChecks__1__Uri=http://identity-api/hc
  - HealthChecksUI__HealthChecks__2__Name="Smoking HTTP Check"
  - HealthChecksUI__HealthChecks__2__Uri=http://smoking-api/hc
  - Serilog__SeqServerUrl
  - OrchestratorType
  - IsClusterEnv
  bindings:
  - name: http
    protocol: http

- name: webblazor
  dockerFile: Web/WebBlazor/Server/DockerFile
  dockerFileContext: .
  env:
  - ASPNETCORE_ENVIRONMENT
  - Serilog__SeqServerUrl
  - OrchestratorType
  - IsClusterEnv
  - IdentityUrlHC="http://identity-api/hc"
  bindings:
  - name: http
    protocol: http