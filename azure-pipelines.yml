pool: 
  name: 'Default'

variables:
  - template: ./deploy/variables/variables.yml
  - group: variables

name: $(TeamProject)_$(Build.DefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:r)
stages:
  - template: ./deploy/stages/docker_build_and_push_stage.yml
    parameters:
      projectName: ${{ variables.projectName }}
  
  - ${{ if eq(variables['Build.SourceBranch'], 'refs/head/main') }}:
    - template: ./deploy/stages/docker_up_stage.yml
      parameters:
        projectName: ${{ variables.projectName }}
